generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

enum SiteThemes {
	light
	dark
}

enum AuthMethods {
	blue_dot
	google
}

model credentials {
	user_id                                                     Int      @id @default(autoincrement())
	username                                                    String?     @unique
	age 														Int?

	password                                                    String?
	is_active                                                   Boolean  @default(true)
	default_site_theme                                          SiteThemes
	sandbox_notes_open											Boolean @default(false)

	auth_method                                                 AuthMethods

	email__encrypted                                            String @unique
	profile_picture_id                                          Int?    @unique
	name														String?

	created_at                                                  DateTime @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt

	login_history                                               login_history[]
	user_pip_uuid_map											user_pip_uuid_map[]
	user_activity_progress										user_activity_progress[]
	user_answer													user_answer[]
	completed_reading_block										completed_reading_block[]
	sandbox_project												sandbox_project[]

	profile_picture                                             profile_picture? @relation(fields: [profile_picture_id], references: [profile_picture_id])

	@@index([profile_picture_id], name:"credentials__profile_picture_id_idx")
}

model login_history {
	login_history_id                                            Int       @id @default(autoincrement())
	user_id                                                     Int
	login_time                                                  DateTime  @default(now())

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "login_history__user_id_idx")
}

model pip_uuid {
	pip_uuid_id                                            		Int       @id @default(autoincrement())
	uuid														String		@unique
	hardware_version											String
	pip_name													String?

	created_at                                                  DateTime  @default(now())

	user_pip_uuid_map											user_pip_uuid_map[]
	@@index([uuid], name: "pip_uuid__uuid_idx")
}

model user_pip_uuid_map {
	user_pip_uuid_map_id										Int       @id @default(autoincrement())
  	user_id             										Int
	pip_uuid_id                                               	Int

	last_connection_time										DateTime @default(now())
	created_at                                                  DateTime  @default(now())
	is_active                                                   Boolean  @default(true)

	user                                                        credentials @relation(fields: [user_id], references: [user_id])
	pip_uuid                                                    pip_uuid @relation(fields: [pip_uuid_id], references: [pip_uuid_id])

	@@index([user_id], name: "user_pip_uuid_map__user_id_idx")
	@@index([pip_uuid_id], name: "user_pip_uuid_map__pip_uuid_id_idx")
	@@unique([user_id, pip_uuid_id])
}

model email_update_subscriber {
	email_update_subscriber_id									Int       @id @default(autoincrement())
	email__encrypted                                            String @unique

	created_at                                                  DateTime  @default(now())
	is_active                                                   Boolean  @default(true)
}

enum ActivityTypes {
	Reading
	Code
	Video
	Demo
	Summary
}

enum LessonNames {
	LED
	Motor
	IMU
	Button
}

// Reference Configuration data
model activity {
	activity_id													Int       @id @default(autoincrement())
	lesson_name													LessonNames
	activity_type	                                            ActivityTypes
	activity_uuid												String		@unique
	activity_name												String
	reading_block                                               reading_block[]

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt
	
	user_activity_progress										user_activity_progress[]
	reading_questions											reading_question[]
	@@unique([activity_type, activity_name])
	@@index([activity_uuid], name: "activity__activity_uuid_idx")
}

enum ProgressStatus {
	IN_PROGRESS
	COMPLETED
}

model user_activity_progress {
	user_activity_progress_id									Int       @id @default(autoincrement())
	user_id             										Int
	activity_id                                               	Int
  	status    													ProgressStatus

  	completed_at  												DateTime?
	created_at                                                  DateTime  @default(now())

	user                                                        credentials @relation(fields: [user_id], references: [user_id])
	activity                                                    activity @relation(fields: [activity_id], references: [activity_id])

	@@index([user_id], name: "user_activity_progress__user_id_idx")
	@@index([activity_id], name: "user_activity_progress__activity_id_idx")
	@@unique([user_id, activity_id])
}

// Reference Configuration data
model reading_block {
	reading_block_id											Int       @id @default(autoincrement())
	reading_id                                               	Int
  	reading_block_name    										String		@unique

	created_at                                                  DateTime  @default(now())

	reading                                                     activity @relation(fields: [reading_id], references: [activity_id])
	completed_reading_block										completed_reading_block[]
	@@index([reading_id], name: "reading_block__reading_id_idx")
}

model completed_reading_block {
	completed_reading_block_id									Int       @id @default(autoincrement())
	reading_block_id											Int
	user_id														Int

	created_at                                                  DateTime  @default(now())
	is_active													Boolean @default(true)

	user                                                        credentials @relation(fields: [user_id], references: [user_id])
	reading_block                                               reading_block @relation(fields: [reading_block_id], references: [reading_block_id])

	@@index([user_id], name: "completed_reading_block__user_id_idx")
	@@index([reading_block_id], name: "completed_reading_block__reading_block_id_idx")
	@@unique([user_id, reading_block_id])
}

// Reference Configuration data
model reading_question {
	reading_question_id											Int       @id @default(autoincrement())
	activity_id                                               	Int
	question_text												String
	reading_question_uuid										String		@unique

	created_at                                                  DateTime  @default(now())

	activity                                                    activity @relation(fields: [activity_id], references: [activity_id])
	reading_question_answer_choice								reading_question_answer_choice[]

	@@index([activity_id], name: "reading_question__activity_id_idx")
	@@unique([activity_id, question_text])
}

// Reference Configuration data
model reading_question_answer_choice {
	reading_question_answer_choice_id							Int       @id @default(autoincrement())
	reading_question_id                                         Int
	answer_text													String
	is_correct													Boolean
	explanation													String

	created_at                                                  DateTime  @default(now())

	reading_question                                            reading_question @relation(fields: [reading_question_id], references: [reading_question_id])
	user_answer												user_answer[]
	@@index([reading_question_id], name: "reading_question_answer_choice__reading_question_id_idx")
	@@unique([reading_question_id, answer_text])
}

model user_answer {
	user_answers_id												Int       @id @default(autoincrement())
	reading_question_answer_choice_id                           Int
	user_id             										Int

	created_at                                                  DateTime  @default(now())

	reading_question                                            reading_question_answer_choice @relation(fields: [reading_question_answer_choice_id], references: [reading_question_answer_choice_id])
	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([reading_question_answer_choice_id], name: "user_answers__reading_question_answer_choice_id_idx")
	@@index([user_id], name: "user_answers__user_id_idx")
	@@unique([reading_question_answer_choice_id, user_id])
}

model sandbox_project {
	sandbox_project_id											Int       @id @default(autoincrement())
	sandbox_xml													String
	project_owner_id       										Int
	project_uuid												String		@unique
	project_name												String?
	project_notes												String?
	is_starred													Boolean @default(false)

	is_active													Boolean @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt

	user                                                        credentials @relation(fields: [project_owner_id], references: [user_id])

	@@index([project_owner_id], name: "sandbox_project__project_owner_id_idx")
	@@index([project_uuid], name: "sandbox_project__project_uuid_idx")
}

model profile_picture {
	profile_picture_id                                          Int @id @default(autoincrement())
	image_url                                                   String
	file_name                                                   String
	uuid                                                        String
  	user_id             										Int    @unique

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials?
}
