generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

enum SiteThemes {
	light
	dark
}

enum AuthMethods {
	blue_dot
	google
}

enum SidebarStates {
	expanded
	collapsed
}

model credentials {
	user_id                                                     Int      @id @default(autoincrement())
	username                                                    String?     @unique

	password                                                    String?
	is_active                                                   Boolean  @default(true)
	default_site_theme                                          SiteThemes
	default_sidebar_state										SidebarStates @default(expanded)

	auth_method                                                 AuthMethods

	email__encrypted                                            String @unique

	created_at                                                  DateTime @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt

	login_history                                               login_history[]
	user_pip_uuid_map											user_pip_uuid_map[]
	user_activity_progress										user_activity_progress[]
	user_answer													user_answer[]
}

model login_history {
	login_history_id                                            Int       @id @default(autoincrement())
	user_id                                                     Int
	login_time                                                  DateTime  @default(now())

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "login_history__user_id_idx")
}

model pip_uuid {
	pip_uuid_id                                            		Int       @id @default(autoincrement())
	uuid														String		@unique
	hardware_version											String
	pip_name													String?

	created_at                                                  DateTime  @default(now())

	user_pip_uuid_map											user_pip_uuid_map[]
}

model user_pip_uuid_map {
	user_pip_uuid_map_id										Int       @id @default(autoincrement())
  	user_id             										Int
	pip_uuid_id                                               	Int

	last_connection_time										DateTime @default(now())
	created_at                                                  DateTime  @default(now())
	is_active                                                   Boolean  @default(true)

	user                                                        credentials @relation(fields: [user_id], references: [user_id])
	pip_uuid                                                    pip_uuid @relation(fields: [pip_uuid_id], references: [pip_uuid_id])

	@@index([user_id], name: "user_pip_uuid_map__user_id_idx")
	@@index([pip_uuid_id], name: "user_pip_uuid_map__pip_uuid_id_idx")
	@@unique([user_id, pip_uuid_id])
}

model email_update_subscriber {
	email_update_subscriber_id									Int       @id @default(autoincrement())
	email__encrypted                                            String @unique

	created_at                                                  DateTime  @default(now())
	is_active                                                   Boolean  @default(true)
}

enum ActivityTypes {
	Reading
	Code
	Video
	Demo
	Summary
}

enum LessonNames {
	LED
	Motor
	IMU
	Button
}

// Reference Configuration data
model activity {
	activity_id													Int       @id @default(autoincrement())
	lesson_name													LessonNames
	activity_type	                                            ActivityTypes
	activity_uuid												String		@unique
	activity_name												String

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt
	
	user_activity_progress										user_activity_progress[]
	reading_questions											reading_question[]
	@@unique([activity_type, activity_name])
}

enum ProgressStatus {
	IN_PROGRESS
	COMPLETED
}

model user_activity_progress {
	user_activity_progress_id									Int       @id @default(autoincrement())
	user_id             										Int
	activity_id                                               	Int
  	status    													ProgressStatus

  	completed_at  												DateTime?
	created_at                                                  DateTime  @default(now())

	user                                                        credentials @relation(fields: [user_id], references: [user_id])
	activity                                                    activity @relation(fields: [activity_id], references: [activity_id])

	@@index([user_id], name: "user_activity_progress__user_id_idx")
	@@index([activity_id], name: "user_activity_progress__activity_id_idx")
	@@unique([user_id, activity_id])
}

// Reference Configuration data
model reading_question {
	reading_question_id											Int       @id @default(autoincrement())
	activity_id                                               	Int
	question_text												String
	reading_question_uuid										String		@unique

	created_at                                                  DateTime  @default(now())

	activity                                                    activity @relation(fields: [activity_id], references: [activity_id])
	reading_question_answer_choice								reading_question_answer_choice[]

	@@index([activity_id], name: "reading_question__activity_id_idx")
	@@unique([activity_id, question_text])
}

// Reference Configuration data
model reading_question_answer_choice {
	reading_question_answer_choice_id							Int       @id @default(autoincrement())
	reading_question_id                                         Int
	answer_text													String
	is_correct													Boolean
	explanation													String

	created_at                                                  DateTime  @default(now())

	reading_question                                            reading_question @relation(fields: [reading_question_id], references: [reading_question_id])
	user_answer												user_answer[]
	@@index([reading_question_id], name: "reading_question_answer_choice__reading_question_id_idx")
	@@unique([reading_question_id, answer_text])
}

model user_answer {
	user_answers_id												Int       @id @default(autoincrement())
	reading_question_answer_choice_id                           Int
	user_id             										Int

	created_at                                                  DateTime  @default(now())

	reading_question                                            reading_question_answer_choice @relation(fields: [reading_question_answer_choice_id], references: [reading_question_answer_choice_id])
	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([reading_question_answer_choice_id], name: "user_answers__reading_question_answer_choice_id_idx")
	@@index([user_id], name: "user_answers__user_id_idx")
	@@unique([reading_question_answer_choice_id, user_id])
}
